<div class="change-password-popup" *ngIf="visible" (click)="onBackdropClick($event)">
    <div class="popup-content" (click)="$event.stopPropagation()">
        <!-- Header -->
        <div class="popup-header">
            <div class="popup-icon">
                <i class="pi pi-key"></i>
            </div>
            <h3>Change Password</h3>
        </div>

        <form [formGroup]="passwordForm" class="password-form">
            <!-- New Password -->
            <div class="form-field">
                <label for="newPassword">New Password <span class="required">*</span></label>
                <div class="input-wrapper">
                    <i class="pi pi-lock field-icon"></i>
                    <input id="newPassword" [type]="showNewPassword ? 'text' : 'password'" pInputText
                        formControlName="newPassword" placeholder="Enter new password"
                        [ngClass]="{'ng-invalid ng-dirty': passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched}">
                    <i class="pi pi-eye toggle-password" (click)="togglePassword('new')"></i>
                </div>
                <small class="error-message"
                    *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
                    Password must be at least 8 chars with uppercase, lowercase, number & special char
                </small>
            </div>

            <!-- Confirm Password -->
            <div class="form-field">
                <label for="confirmPassword">Confirm Password <span class="required">*</span></label>
                <div class="input-wrapper">
                    <i class="pi pi-lock field-icon"></i>
                    <input id="confirmPassword" [type]="showConfirmPassword ? 'text' : 'password'" pInputText
                        formControlName="confirmPassword" placeholder="Confirm new password"
                        [ngClass]="{'ng-invalid ng-dirty': passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched}">
                    <i class="pi pi-eye toggle-password" (click)="togglePassword('confirm')"></i>
                </div>
                <small class="error-message"
                    *ngIf="passwordForm.hasError('mismatch') && passwordForm.get('confirmPassword')?.touched">
                    Passwords do not match
                </small>
            </div>

            <div class="popup-actions">
                <button type="button" class="btn-cancel" (click)="onCancel(); $event.stopPropagation()">
                    <i class="pi pi-times"></i>
                    Cancel
                </button>
                <button type="submit" class="btn-confirm"
                    [disabled]="passwordForm.invalid || passwordForm.hasError('mismatch') || users.length <= 1"
                    (click)="onSubmit()">
                    <i class="pi pi-save"></i>
                    Update Password
                </button>
            </div>
        </form>
    </div>
</div>