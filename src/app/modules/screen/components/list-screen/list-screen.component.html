<div class="dataset-page-wrapper">
  <div class="dataset-content-container">

    <!-- Header Section -->
    <div class="page-header-section">
      <div class="header-content">
        <h2>Screens</h2>
      </div>
    </div>

    <!-- Unified Toolbar & Content Card -->
    <div class="content-card">
      <div class="card-toolbar">
        <div class="toolbar-left">
          <!-- Organisation Dropdown -->
          <div class="dropdown-field" *ngIf="showOrganisationDropdown">
            <app-custom-dropdown [(ngModel)]="selectedOrg" [options]="organisations" optionLabel="name" optionValue="id"
              [filter]="true" label="Organisation" [floatingLabel]="true" filterBy="name"
              (onChangeEvent)="onOrgChange($event)">
            </app-custom-dropdown>
          </div>

          <!-- Database Dropdown -->
          <div class="dropdown-field">
            <app-custom-dropdown [(ngModel)]="selectedDatabase" placeholder="Select Database" [options]="databases"
              optionLabel="name" optionValue="id" [filter]="true" [floatingLabel]="true" label="Database"
              filterBy="name" (onChangeEvent)="onDBChange($event)">
            </app-custom-dropdown>
          </div>
        </div>

        <div class="toolbar-right">
          <!-- Search -->
          <span class="p-input-icon-left search-input-wrapper">
            <i class="pi pi-search"></i>
            <input pInputText type="text" (input)="dt.filterGlobal($any($event.target).value, 'contains')"
              placeholder="Search..." class="modern-search" />
          </span>

          <!-- Add Button -->
          <button pButton label="Add" icon="pi pi-plus" (click)="onAddNewScreen()"
            class="p-button-raised p-button-primary modern-button">
          </button>
        </div>
      </div>

      <!-- Table -->
      <div class="table-wrapper">
        <p-table #dt [value]="screens" [rows]="10" [paginator]="true"
          [globalFilterFields]="['name', 'description', 'status']" [rowHover]="true" dataKey="id"
          currentPageReportTemplate="{first} - {last} of {totalRecords}" [showCurrentPageReport]="true"
          [rowsPerPageOptions]="[10,25,50,100]" styleClass="p-datatable-sm modern-table" [scrollable]="true"
          scrollHeight="calc(100vh - 400px)">

          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="name" style="width: 25%">
                <div class="th-content">
                  Name <p-sortIcon field="name"></p-sortIcon>
                </div>
              </th>
              <th pSortableColumn="description" style="width: 30%">
                <div class="th-content">
                  Description <p-sortIcon field="description"></p-sortIcon>
                </div>
              </th>
              <th pSortableColumn="status" style="width: 15%">
                <div class="th-content">
                  Status <p-sortIcon field="status"></p-sortIcon>
                </div>
              </th>
              <th pSortableColumn="createdOn" style="width: 15%">
                <div class="th-content">
                  Created <p-sortIcon field="createdOn"></p-sortIcon>
                </div>
              </th>
              <th style="width: 15%">
                <!-- Actions -->
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-screen>
            <tr class="modern-row">
              <td>
                <a class="dataset-name-link" [routerLink]="['/app/screen/view', selectedOrg, screen.id]">
                  <i class="pi pi-desktop" style="margin-right: 8px;"></i>
                  {{ screen.name }}
                </a>
              </td>
              <td>
                <span class="description-text" [title]="screen.description">
                  {{ screen.description }}
                </span>
              </td>
              <td>
                <span class="status-indicator"
                  [ngClass]="{'active': screen.status === 1, 'inactive': screen.status !== 1}">
                  <span class="dot"></span>
                  {{ screen.status === 1 ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td>
                <span class="date-text">{{ screen.createdOn | date:'mediumDate' }}</span>
              </td>
              <td>
                <div class="row-actions">
                  <button class="icon-btn edit-btn" (click)="onEditScreen(screen)" pTooltip="Edit"
                    tooltipPosition="left">
                    <i class="pi pi-pencil"></i>
                  </button>
                  <button class="icon-btn config-btn" (click)="onConfig(screen.id)" pTooltip="Config"
                    tooltipPosition="left">
                    <i class="pi pi-cog"></i>
                  </button>
                  <button class="icon-btn execute-btn" (click)="onExecute(screen.id)" pTooltip="Execute"
                    tooltipPosition="left">
                    <i class="pi pi-play"></i>
                  </button>
                  <button class="icon-btn delete-btn" (click)="confirmDelete(screen.id)" pTooltip="Delete"
                    tooltipPosition="left">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="5" class="empty-message-cell">
                No such record found
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>

<div class="confirmation-popup" *ngIf="showDeleteConfirm">
  <div class="popup-content">
    <h3>Confirm Delete</h3>
    <p>Are you sure you want to delete this Screen?</p>
    <div class="popup-actions">
      <button class="btn-cancel" (click)="cancelDelete()">No</button>
      <button class="btn-confirm" (click)="proceedDelete()">Yes</button>
    </div>
  </div>
</div>