<div class="dataset-page-wrapper">
  <div class="dataset-content-container">
    <!-- Page Header -->
    <div class="page-header-section">
      <div class="header-content">
        <h2>Screens</h2>
        <p class="subtitle">Design query forms using organized tabs, sections, and prompts</p>
      </div>
    </div>

    <!-- Content Card -->
    <div class="content-card">
      <!-- Toolbar -->
      <div class="card-toolbar">
        <div class="toolbar-left">
          <!-- Organisation Dropdown -->
          <div class="dropdown-field" *ngIf="showOrganisationDropdown">
            <app-custom-dropdown [(ngModel)]="selectedOrg" [options]="organisations" optionLabel="name" optionValue="id"
              [filter]="true" label="Organisation" [floatingLabel]="true" filterBy="name"
              (onChangeEvent)="onOrgChange($event)">
            </app-custom-dropdown>
          </div>

          <!-- Database Dropdown -->
          <div class="dropdown-field">
            <app-custom-dropdown [(ngModel)]="selectedDatabase" placeholder="Select Database" [options]="databases"
              optionLabel="name" optionValue="id" [filter]="true" [floatingLabel]="true" label="Database"
              filterBy="name" (onChangeEvent)="onDBChange($event)">
            </app-custom-dropdown>
          </div>
        </div>

        <div class="toolbar-right">
          <!-- Clear Filters Button -->
          <button pButton label="Clear Filters" icon="pi pi-filter-slash" (click)="clearFilters()"
            [disabled]="!isFilterActive" class="p-button-outlined p-button-danger modern-button mr-2">
          </button>

          <!-- Add Button -->
          <button pButton label="Add" icon="pi pi-plus" (click)="onAddNewScreen()"
            class="p-button-raised p-button-primary modern-button">
          </button>
        </div>
      </div>

      <!-- Table Wrapper -->
      <div class="table-wrapper">
        <p-table #dt [value]="screens" [rows]="10" [paginator]="true" [lazy]="true" (onLazyLoad)="loadScreens($event)"
          [totalRecords]="totalRecords" [globalFilterFields]="['name', 'description', 'status']" [rowHover]="true"
          dataKey="id" currentPageReportTemplate="{first} - {last} of {totalRecords}" [showCurrentPageReport]="true"
          [rowsPerPageOptions]="[10,25,50,100]" styleClass="p-datatable-sm modern-table" [scrollable]="true"
          scrollHeight="calc(100vh - 400px)">

          <ng-template pTemplate="header">
            <tr>
              <th style="width: 25%" pFrozenColumn>
                <div class="th-content">Name</div>
              </th>
              <th style="width: 30%">
                <div class="th-content">Description</div>
              </th>
              <th style="width: 15%">
                <div class="th-content">Status</div>
              </th>
              <th style="width: 15%">
                <div class="th-content">Created</div>
              </th>
              <th style="width: 15%">
                <div class="th-content centered-header">Actions</div>
              </th>
            </tr>
            <!-- Filter Row -->
            <tr>
              <th pFrozenColumn>
                <input pInputText type="text" [(ngModel)]="filterValues.name" (input)="onFilterChange()"
                  placeholder="Search Name" class="w-full p-column-filter">
              </th>
              <th>
                <input pInputText type="text" [(ngModel)]="filterValues.description" (input)="onFilterChange()"
                  placeholder="Search Description" class="w-full p-column-filter">
              </th>
              <th></th>
              <th></th>
              <th></th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-screen>
            <tr class="modern-row">
              <td pFrozenColumn>
                <a class="dataset-name-link" [routerLink]="['/app/screen/view', selectedOrg, screen.id]">
                  {{ screen.name }}
                </a>
              </td>
              <td>
                <span class="description-text" [title]="screen.description">
                  {{ screen.description }}
                </span>
              </td>
              <td>
                <span class="status-indicator"
                  [ngClass]="{'active': screen.status === 1, 'inactive': screen.status !== 1}">
                  <span class="dot"></span>
                  {{ screen.status === 1 ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td>
                <span class="date-text">{{ screen.createdOn | date:'medium' }}</span>
              </td>
              <td>
                <div class="row-actions">
                  <button class="icon-btn edit-btn" (click)="onEditScreen(screen)" pTooltip="Edit"
                    tooltipPosition="left">
                    <i class="pi pi-pencil"></i>
                  </button>
                  <button class="icon-btn config-btn" (click)="onConfig(screen.id)" pTooltip="Config"
                    tooltipPosition="left">
                    <i class="pi pi-cog"></i>
                  </button>
                  <button class="icon-btn execute-btn" (click)="onExecute(screen.id)" pTooltip="Execute"
                    tooltipPosition="left">
                    <i class="pi pi-play"></i>
                  </button>
                  <button class="icon-btn delete-btn" (click)="confirmDelete(screen.id)" pTooltip="Delete"
                    tooltipPosition="left">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="5" class="empty-message-cell text-center">
                No such record found
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>

<div class="confirmation-popup" *ngIf="showDeleteConfirm">
  <div class="popup-content">
    <!-- Header -->
    <div class="popup-header">
      <div class="popup-icon">
        <i class="pi pi-trash"></i>
      </div>
      <h3>Confirm Delete</h3>
    </div>

    <!-- Delete Info Section -->
    <div class="standard-delete-section">
      <p class="delete-intro">
        Are you sure you want to delete this screen?
      </p>

      <ul class="delete-info-list">
        <li>
          <i class="pi pi-info-circle"></i>
          <span>This action cannot be undone</span>
        </li>
      </ul>
    </div>

    <!-- Actions -->
    <div class="popup-actions">
      <button class="btn-cancel" (click)="cancelDelete()">
        <i class="pi pi-times"></i>
        Cancel
      </button>
      <button class="btn-confirm" (click)="proceedDelete()">
        <i class="pi pi-trash"></i>
        Delete
      </button>
    </div>
  </div>
</div>