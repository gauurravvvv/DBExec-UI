<div class="add-admin-wrapper">
    <div class="add-admin-container">
        <!-- Header Section -->
        <div class="page-header">
            <div class="left-section">
                <button pButton class="p-button-text back-button" routerLink="/app/organisation">
                    <i class="pi pi-arrow-left"></i>
                </button>
                <h2>Add Organisation</h2>
            </div>
            <div class="action-buttons">
                <button pButton type="button" label="Cancel" class="p-button-outlined btn-cancel"
                    [disabled]="!isFormDirty || orgForm.pristine" (click)="onCancel()">
                </button>
                <ng-container *ngIf="currentStep === 0">
                    <button pButton type="button" label="Next" (click)="nextStep()" class="p-button-primary btn-save"
                        [disabled]="!isBasicInfoValid()">
                        <i class="pi pi-arrow-right ml-2"></i>
                    </button>
                </ng-container>
                <ng-container *ngIf="currentStep === 1">
                    <button pButton type="button" label="Previous" class="p-button-outlined btn-cancel"
                        (click)="previousStep()">
                        <i class="pi pi-arrow-left mr-2"></i>
                    </button>
                    <button pButton class="p-button-primary btn-save" type="submit" label="Save" (click)="onSubmit()"
                        [disabled]="!isFormValid()">
                        <i class="pi pi-save mr-2"></i>
                    </button>
                </ng-container>
            </div>
        </div>

        <!-- Steps -->
        <div class="steps-container" [ngClass]="'step-' + (currentStep + 1)">
            <div class="step" [class.active]="currentStep === 0">
                <div class="step-dot">1</div>
                <span class="step-label">Basic Information</span>
            </div>
            <div class="step-line"></div>
            <div class="step" [class.active]="currentStep === 1">
                <div class="step-dot">2</div>
                <span class="step-label">Organisation Configuration</span>
            </div>
        </div>

        <form [formGroup]="orgForm" class="admin-form mt-4">
            <!-- Step 1: Basic Information -->
            <div *ngIf="currentStep === 0" class="form-grid">
                <!-- Organisation Name -->
                <app-custom-input formControlName="name" label="Organisation Name" placeholder="Enter organisation name"
                    icon="pi-building" [required]="true"
                    [showError]="!!(orgForm.get('name')?.invalid && orgForm.get('name')?.touched)"
                    errorMessage="Organisation name is required">
                </app-custom-input>

                <!-- Organisation Description -->
                <app-custom-input formControlName="description" label="Organisation Description"
                    placeholder="Enter organisation description" icon="pi-align-left" [required]="true"
                    [showError]="!!(orgForm.get('description')?.invalid && orgForm.get('description')?.touched)"
                    errorMessage="Organisation description is required">
                </app-custom-input>
            </div>

            <!-- Step 2: Organisation Configuration -->
            <div *ngIf="currentStep === 1" class="form-grid">

                <!-- Encryption Method -->
                <app-custom-dropdown formControlName="encryptionAlgorithm" label="Encryption Method"
                    placeholder="Select Encryption Method" [options]="encryptionAlgorithms" optionLabel="label"
                    optionValue="value" [filter]="true" filterBy="label" [required]="true"
                    [showError]="!!(orgForm.get('encryptionAlgorithm')?.invalid && orgForm.get('encryptionAlgorithm')?.touched)"
                    errorMessage="Encryption method is required">
                </app-custom-dropdown>

                <!-- Pepper Key -->
                <div class="form-field">
                    <label for="pepperKey">Pepper Key<span class="required"> *</span></label>
                    <span class="p-input-icon-left p-input-icon-right">
                        <i class="pi pi-lock"></i>
                        <input id="pepperKey" type="password" pInputText formControlName="pepperKey"
                            placeholder="Enter pepper key (minimum 32 characters)"
                            [ngClass]="{'ng-invalid ng-dirty': orgForm.get('pepperKey')?.invalid && orgForm.get('pepperKey')?.touched}">
                        <i class="pi pi-eye" style="cursor: pointer;" (click)="togglePepperKeyVisibility($event)"></i>
                    </span>
                    <small class="error-message"
                        *ngIf="orgForm.get('pepperKey')?.invalid && orgForm.get('pepperKey')?.touched">
                        <span *ngIf="orgForm.get('pepperKey')?.errors?.['required']">Pepper key is required</span>
                        <span *ngIf="orgForm.get('pepperKey')?.errors?.['pattern']">
                            Pepper key must be at least 32 characters long and can contain letters, numbers, and special
                            characters
                        </span>
                    </small>
                </div>

                <!-- Add this after the Pepper Key field but before closing the form-grid div -->
                <div class="acknowledgments-container">
                    <div class="acknowledgments-title">
                        Security Configuration Acknowledgment
                    </div>
                    <div class="acknowledgment-card">
                        <div class="p-field-checkbox">
                            <p-checkbox [binary]="true" [(ngModel)]="confirmationChecked"
                                [ngModelOptions]="{standalone: true}" inputId="confirmation">
                            </p-checkbox>
                            <div class="acknowledgment-content">
                                <label for="confirmation" class="acknowledgment-label">
                                    Encryption Configuration
                                </label>
                                <p class="acknowledgment-text">
                                    I understand that the encryption method and pepper key are critical security
                                    settings that cannot be modified after organisation creation. These settings will be
                                    used for all sensitive data encryption within the organisation.
                                </p>
                            </div>
                        </div>
                        <small class="error-message" *ngIf="!confirmationChecked && orgForm.valid">
                            Please acknowledge the encryption configuration settings
                        </small>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>