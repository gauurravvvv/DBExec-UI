<div class="add-admin-wrapper">
    <div class="add-admin-container">
        <!-- Header Section -->
        <div class="page-header">
            <div class="left-section">
                <button pButton class="p-button-text" routerLink="/app/organisation">
                    <i class="pi pi-arrow-left"></i>
                </button>
                <h2>Add Organisation</h2>
            </div>
            <div class="action-buttons">
                <button pButton type="button" label="Cancel" class="p-button-outlined p-button-danger"
                    [disabled]="!isFormDirty || orgForm.pristine" (click)="onCancel()">
                </button>
                <ng-container *ngIf="currentStep === 0">
                    <button pButton type="button" label="Next" (click)="nextStep()" class="p-button-outlined"
                        [disabled]="!isBasicInfoValid()">
                        <i class="pi pi-arrow-right ml-2"></i>
                    </button>
                </ng-container>
                <ng-container *ngIf="currentStep === 1">
                    <button pButton type="button" label="Previous" class="p-button-outlined" (click)="previousStep()">
                        <i class="pi pi-arrow-left mr-2"></i>
                    </button>
                    <button pButton class="p-button-outlined" type="submit" label="Save" (click)="onSubmit()"
                        [disabled]="!isFormValid()">
                        <i class="pi pi-save mr-2"></i>
                    </button>
                </ng-container>
            </div>
        </div>

        <!-- Steps -->
        <div class="steps-container" [ngClass]="'step-' + (currentStep + 1)">
            <div class="step" [class.active]="currentStep === 0">
                <div class="step-dot">1</div>
                <span class="step-label">Basic Information</span>
            </div>
            <div class="step-line"></div>
            <div class="step" [class.active]="currentStep === 1">
                <div class="step-dot">2</div>
                <span class="step-label">Organisation Configuration</span>
            </div>
        </div>

        <form [formGroup]="orgForm" class="admin-form mt-4">
            <!-- Step 1: Basic Information -->
            <div *ngIf="currentStep === 0" class="form-grid">
                <!-- Organisation Name -->
                <app-custom-input formControlName="name" label="Organisation Name" placeholder="Enter organisation name"
                    icon="pi-building" [required]="true"
                    [showError]="!!(orgForm.get('name')?.invalid && orgForm.get('name')?.touched)"
                    errorMessage="Organisation name is required">
                </app-custom-input>

                <!-- Organisation Description -->
                <app-custom-input formControlName="description" label="Organisation Description"
                    placeholder="Enter organisation description" icon="pi-align-left" [required]="true"
                    [showError]="!!(orgForm.get('description')?.invalid && orgForm.get('description')?.touched)"
                    errorMessage="Organisation description is required">
                </app-custom-input>
            </div>

            <!-- Step 2: Organisation Configuration -->
            <div *ngIf="currentStep === 1" class="form-grid">
                <!-- Max Admins -->
                <app-custom-input formControlName="maxAdmins" label="Maximum Admins" placeholder="Enter maximum admins"
                    icon="pi-user-plus" [required]="true"
                    [showError]="!!(orgForm.get('maxAdmins')?.invalid && orgForm.get('maxAdmins')?.touched)"
                    [errorMessage]="orgForm.get('maxAdmins')?.errors?.['required'] ? 'Maximum admins is required' : 
                                   orgForm.get('maxAdmins')?.errors?.['min'] ? 'Value must be at least 1' : ''">
                </app-custom-input>

                <!-- Max Users -->
                <app-custom-input formControlName="maxUsers" label="Maximum Users" placeholder="Enter maximum users"
                    icon="pi-user" [required]="true"
                    [showError]="!!(orgForm.get('maxUsers')?.invalid && orgForm.get('maxUsers')?.touched)"
                    [errorMessage]="orgForm.get('maxUsers')?.errors?.['required'] ? 'Maximum users is required' : 
                                   orgForm.get('maxUsers')?.errors?.['min'] ? 'Value must be at least 1' : ''">
                </app-custom-input>

                <!-- Max User Groups -->
                <app-custom-input formControlName="maxGroups" label="Maximum Groups" placeholder="Enter maximum groups"
                    icon="pi-users" [required]="true"
                    [showError]="!!(orgForm.get('maxGroups')?.invalid && orgForm.get('maxGroups')?.touched)"
                    [errorMessage]="orgForm.get('maxGroups')?.errors?.['required'] ? 'Maximum groups is required' : 
                                   orgForm.get('maxGroups')?.errors?.['min'] ? 'Value must be at least 1' : ''">
                </app-custom-input>

                <!-- Max Environments -->
                <app-custom-input formControlName="maxEnvironments" label="Maximum Environments"
                    placeholder="Enter maximum environments" icon="pi-globe" [required]="true"
                    [showError]="!!(orgForm.get('maxEnvironments')?.invalid && orgForm.get('maxEnvironments')?.touched)"
                    [errorMessage]="orgForm.get('maxEnvironments')?.errors?.['required'] ? 'Maximum environments is required' : 
                                   orgForm.get('maxEnvironments')?.errors?.['min'] ? 'Value must be at least 1' : ''">
                </app-custom-input>

                <!-- Max Categories -->
                <app-custom-input formControlName="maxCategories" label="Maximum Categories"
                    placeholder="Enter maximum categories" icon="pi-list" [required]="true"
                    [showError]="!!(orgForm.get('maxCategories')?.invalid && orgForm.get('maxCategories')?.touched)"
                    [errorMessage]="orgForm.get('maxCategories')?.errors?.['required'] ? 'Maximum categories is required' : 
                                   orgForm.get('maxCategories')?.errors?.['min'] ? 'Value must be at least 1' : ''">
                </app-custom-input>

                <!-- Max Databases -->
                <app-custom-input formControlName="maxDatabases" label="Maximum Databases"
                    placeholder="Enter maximum databases" icon="pi-database" [required]="true"
                    [showError]="!!(orgForm.get('maxDatabases')?.invalid && orgForm.get('maxDatabases')?.touched)"
                    [errorMessage]="orgForm.get('maxDatabases')?.errors?.['required'] ? 'Maximum databases is required' : 
                                   orgForm.get('maxDatabases')?.errors?.['min'] ? 'Value must be at least 1' : ''">
                </app-custom-input>

                <!-- Encryption Method -->
                <app-custom-dropdown formControlName="encryptionAlgorithm" label="Encryption Method"
                    placeholder="Select Encryption Method" [options]="encryptionAlgorithms" optionLabel="label"
                    optionValue="value" [filter]="true" filterBy="label" [required]="true"
                    [showError]="!!(orgForm.get('encryptionAlgorithm')?.invalid && orgForm.get('encryptionAlgorithm')?.touched)"
                    errorMessage="Encryption method is required">
                </app-custom-dropdown>

                <!-- Pepper Key -->
                <div class="form-field">
                    <label for="pepperKey">Pepper Key<span class="required"> *</span></label>
                    <span class="p-input-icon-left p-input-icon-right">
                        <i class="pi pi-lock"></i>
                        <input id="pepperKey" type="password" pInputText formControlName="pepperKey"
                            placeholder="Enter pepper key (minimum 32 characters)"
                            [ngClass]="{'ng-invalid ng-dirty': orgForm.get('pepperKey')?.invalid && orgForm.get('pepperKey')?.touched}">
                        <i class="pi pi-eye" style="cursor: pointer;" (click)="togglePepperKeyVisibility($event)"></i>
                    </span>
                    <small class="error-message"
                        *ngIf="orgForm.get('pepperKey')?.invalid && orgForm.get('pepperKey')?.touched">
                        <span *ngIf="orgForm.get('pepperKey')?.errors?.['required']">Pepper key is required</span>
                        <span *ngIf="orgForm.get('pepperKey')?.errors?.['pattern']">
                            Pepper key must be at least 32 characters long and can contain letters, numbers, and special
                            characters
                        </span>
                    </small>
                </div>

                <!-- Add this after the Pepper Key field but before closing the form-grid div -->
                <div class="acknowledgments-container">
                    <div class="acknowledgments-title">
                        Security Configuration Acknowledgment
                    </div>
                    <div class="acknowledgment-card">
                        <div class="p-field-checkbox">
                            <p-checkbox [binary]="true" [(ngModel)]="confirmationChecked"
                                [ngModelOptions]="{standalone: true}" inputId="confirmation">
                            </p-checkbox>
                            <div class="acknowledgment-content">
                                <label for="confirmation" class="acknowledgment-label">
                                    Encryption Configuration
                                </label>
                                <p class="acknowledgment-text">
                                    I understand that the encryption method and pepper key are critical security
                                    settings that cannot be modified after organization creation. These settings will be
                                    used for all sensitive data encryption within the organization.
                                </p>
                            </div>
                        </div>
                        <small class="error-message" *ngIf="!confirmationChecked && orgForm.valid">
                            Please acknowledge the encryption configuration settings
                        </small>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>