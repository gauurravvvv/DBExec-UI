<div class="add-admin-wrapper">
  <div class="add-admin-container">
    <!-- Header Section -->
    <div class="page-header">
      <div class="left-section">
        <button pButton class="p-button-text" routerLink="/app/database">
          <i class="pi pi-arrow-left"></i>
        </button>
        <h2>Add Database</h2>
      </div>
      <div class="action-buttons">
        <button pButton type="button" label="Cancel" class="p-button-outlined p-button-danger" [disabled]="!isFormDirty"
          (click)="onCancel()"></button>
        <button pButton class="p-button-outlined" type="submit" label="Save" (click)="onSubmit()"
          [disabled]="databaseForm.invalid">
          <i class="pi pi-save mr-2"></i>
        </button>
      </div>
    </div>

    <!-- Form Section -->
    <form [formGroup]="databaseForm" class="admin-form">
      <div class="left-section">
        <!-- Main form grid -->
        <div class="form-grid">
          <!-- Name Field -->
          <app-custom-input formControlName="name" label="Name" placeholder="Enter name" icon="pi-database"
            [required]="true" [showError]="!!(databaseForm.get('name')?.invalid && databaseForm.get('name')?.touched)"
            [errorMessage]="getErrorMessage('name')">
          </app-custom-input>

          <!-- Description Field -->
          <app-custom-input formControlName="description" label="Description" placeholder="Enter description"
            icon="pi-align-left" [required]="true"
            [showError]="!!(databaseForm.get('description')?.invalid && databaseForm.get('description')?.touched)"
            [errorMessage]="getErrorMessage('description')">
          </app-custom-input>

          <!-- Organisation Dropdown -->
          <app-custom-dropdown *ngIf="showOrganisationDropdown" formControlName="organisation" label="Organisation"
            placeholder="Select Organisation" [options]="organisations" optionLabel="name" optionValue="id"
            [filter]="true" filterBy="name" [required]="true"
            [showError]="!!(databaseForm.get('organisation')?.invalid && databaseForm.get('organisation')?.touched)"
            errorMessage="Organisation is required">
          </app-custom-dropdown>

          <!-- Master DB Toggle -->
          <app-custom-toggle formControlName="isMasterDB" label="Master Database" [trueValue]="true"
            [falseValue]="false" trueLabel="Yes" falseLabel="No">
          </app-custom-toggle>

          <!-- Type Field (readonly) -->
          <div class="form-field">
            <label for="type">Type</label>
            <span class="p-input-icon-left">
              <i class="pi pi-database"></i>
              <input id="type" pInputText formControlName="type" readonly class="readonly" />
            </span>
          </div>

          <!-- Host Field -->
          <app-custom-input formControlName="host" label="Host" placeholder="Enter database host" icon="pi-desktop"
            [required]="true" [showError]="!!(databaseForm.get('host')?.invalid && databaseForm.get('host')?.touched)"
            [errorMessage]="getErrorMessage('host')">
          </app-custom-input>

          <!-- Port Field -->
          <div class="form-field">
            <label for="port">Port<span class="required"> *</span></label>
            <span class="p-input-icon-left">
              <i class="pi pi-hashtag"></i>
              <input id="port" type="number" pInputText formControlName="port" placeholder="Enter database port" min="1"
                max="65535" (keypress)="onPortKeyPress($event)" [ngClass]="{
                  'ng-invalid ng-dirty':
                    databaseForm.get('port')?.invalid &&
                    databaseForm.get('port')?.touched
                }" class="p-inputtext" />
            </span>
            <small class="error-message" *ngIf="
                databaseForm.get('port')?.invalid &&
                databaseForm.get('port')?.touched
              ">
              {{ getErrorMessage('port') }}
            </small>
          </div>

          <!-- Database Name Field -->
          <app-custom-input formControlName="database" label="Database Name" placeholder="Enter database name"
            icon="pi-database" [required]="true"
            [showError]="!!(databaseForm.get('database')?.invalid && databaseForm.get('database')?.touched)"
            [errorMessage]="getErrorMessage('database')">
          </app-custom-input>

          <!-- Username Field -->
          <app-custom-input formControlName="username" label="Username" placeholder="Enter database username"
            icon="pi-user" [required]="true"
            [showError]="!!(databaseForm.get('username')?.invalid && databaseForm.get('username')?.touched)"
            [errorMessage]="getErrorMessage('username')">
          </app-custom-input>

          <!-- Database Password Field -->
          <div class="form-field">
            <label for="password">Password<span class="required"> *</span></label>
            <span class="p-input-icon-left p-input-icon-right">
              <i class="pi pi-lock"></i>
              <input id="password" [type]="showPassword ? 'text' : 'password'" pInputText formControlName="password"
                placeholder="Enter database password" [ngClass]="{
                  'ng-invalid ng-dirty':
                    databaseForm.get('password')?.invalid &&
                    databaseForm.get('password')?.touched
                }" class="p-inputtext" />
              <i class="pi pi-eye" style="cursor: pointer" (click)="togglePassword($event, 'password')"></i>
            </span>
            <small class="error-message" *ngIf="
                databaseForm.get('password')?.invalid &&
                databaseForm.get('password')?.touched
              ">
              {{ getErrorMessage('password') }}
            </small>
          </div>


        </div>

        <!-- Acknowledgments Section at bottom of left side -->
        <div class="acknowledgments-container" *ngIf="databaseForm.get('isMasterDB')?.value">
          <h3 class="acknowledgments-title">Required Acknowledgments</h3>

          <div class="acknowledgment-card">
            <div class="p-field-checkbox">
              <p-checkbox formControlName="acknowledgment" [binary]="true" inputId="acknowledgment">
              </p-checkbox>
              <div class="acknowledgment-content">
                <label for="acknowledgment" class="acknowledgment-label">
                  Database Administrator Privileges
                </label>
                <p class="acknowledgment-text">
                  I acknowledge that the username provided has admin privileges
                  for this database.
                </p>
              </div>
            </div>
            <small class="error-message" *ngIf="
                databaseForm.get('acknowledgment')?.invalid &&
                databaseForm.get('acknowledgment')?.touched
              ">
              Please acknowledge this requirement
            </small>
          </div>

          <div class="acknowledgment-card">
            <div class="p-field-checkbox">
              <p-checkbox formControlName="schemaAcknowledgment" [binary]="true" inputId="schemaAcknowledgment">
              </p-checkbox>
              <div class="acknowledgment-content">
                <label for="schemaAcknowledgment" class="acknowledgment-label">
                  Schema Creation Authorization
                </label>
                <p class="acknowledgment-text">
                  I hereby authorize DBExec to create and maintain a
                  'dbexec_master' schema with all necessary database objects
                  required for system operations.
                </p>
              </div>
            </div>
            <small class="error-message" *ngIf="
                databaseForm.get('schemaAcknowledgment')?.invalid &&
                databaseForm.get('schemaAcknowledgment')?.touched
              ">
              Please acknowledge this requirement
            </small>
          </div>
        </div>
      </div>

      <!-- Admin credentials on right -->
      <div class="admin-credentials" *ngIf="databaseForm.get('isMasterDB')?.value">
        <!-- System Admin Email Field -->
        <app-custom-input formControlName="adminEmail" label="Admin Email" placeholder="Enter email address"
          icon="pi-envelope" type="email" [required]="true"
          [showError]="!!(databaseForm.get('adminEmail')?.invalid && databaseForm.get('adminEmail')?.touched)"
          [errorMessage]="databaseForm.get('adminEmail')?.errors?.['required'] ? 'Email is required' : 
                         databaseForm.get('adminEmail')?.errors?.['email'] ? 'Please enter a valid email' : ''">
        </app-custom-input>

        <!-- Admin Password Field -->
        <div class="form-field">
          <label for="adminPassword">Admin Password<span class="required"> *</span></label>
          <span class="p-input-icon-left p-input-icon-right">
            <i class="pi pi-lock"></i>
            <input id="adminPassword" [type]="showAdminPassword ? 'text' : 'password'" pInputText
              formControlName="adminPassword" placeholder="Enter password" [ngClass]="{
                'ng-invalid ng-dirty':
                  databaseForm.get('adminPassword')?.invalid &&
                  databaseForm.get('adminPassword')?.touched
              }" />
            <i class="pi pi-eye" style="cursor: pointer" (click)="togglePassword($event, 'adminPassword')"></i>
          </span>
          <small class="error-message" *ngIf="
              databaseForm.get('adminPassword')?.invalid &&
              databaseForm.get('adminPassword')?.touched
            ">
            Password must contain at least 8 characters, one uppercase letter,
            one lowercase letter, one number and one special character
          </small>
        </div>
      </div>
    </form>
  </div>
</div>