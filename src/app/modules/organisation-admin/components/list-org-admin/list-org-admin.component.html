<div class="dataset-page-wrapper">
  <div class="dataset-content-container">

    <!-- Header Section -->
    <div class="page-header-section">
      <div class="header-content">
        <h2>Admins</h2>
        <p class="subtitle">Manage organisation administrators with full local access</p>
      </div>
    </div>

    <!-- Unified Toolbar & Content Card -->
    <div class="content-card">
      <div class="card-toolbar">
        <div class="toolbar-left">
          <!-- Organisation Dropdown -->
          <div class="dropdown-field" *ngIf="showOrganisationDropdown">
            <app-custom-dropdown [(ngModel)]="selectedOrg" [options]="organisations" optionLabel="name" optionValue="id"
              [filter]="true" label="Organisation" [floatingLabel]="true" filterBy="name"
              (onChangeEvent)="onOrgChange($event)">
            </app-custom-dropdown>
          </div>
        </div>

        <div class="toolbar-right">
          <!-- Clear Filters Button -->
          <button pButton label="Clear Filters" icon="pi pi-filter-slash" (click)="clearFilters()"
            [disabled]="!isFilterActive" class="p-button-outlined p-button-danger modern-button mr-2">
          </button>

          <!-- Add Button -->
          <button pButton label="Add" icon="pi pi-plus" (click)="onAddNewAdmin()"
            class="p-button-raised p-button-primary modern-button">
          </button>
        </div>
      </div>

      <!-- Table -->
      <div class="table-wrapper">
        <p-table #dt [value]="filteredAdmins" [rows]="10" [paginator]="true" [lazy]="true"
          (onLazyLoad)="loadAdmins($event)" [totalRecords]="totalRecords"
          [globalFilterFields]="['firstName', 'lastName', 'email', 'status']" [rowHover]="true" dataKey="id"
          currentPageReportTemplate="{first} - {last} of {totalRecords}" [showCurrentPageReport]="true"
          [rowsPerPageOptions]="[10,25,50,100]" styleClass="p-datatable-sm modern-table" [scrollable]="true"
          scrollHeight="calc(100vh - 400px)">

          <ng-template pTemplate="header">
            <tr>
              <th style="width: 15%" pFrozenColumn>
                <div class="th-content">
                  Username
                </div>
              </th>
              <th style="width: 15%">
                <div class="th-content">
                  First Name
                </div>
              </th>
              <th style="width: 15%">
                <div class="th-content">
                  Last Name
                </div>
              </th>
              <th style="width: 20%">
                <div class="th-content">
                  Email
                </div>
              </th>
              <th style="width: 10%">
                <div class="th-content">
                  Status
                </div>
              </th>
              <th style="width: 12%">
                <div class="th-content">
                  Last Login
                </div>
              </th>
              <th style="width: 12%">
                <div class="th-content">
                  Created
                </div>
              </th>
              <th style="width: 8%">
                <div class="th-content">
                  Actions
                </div>
              </th>
            </tr>
            <!-- Filter Row -->
            <tr>
              <th pFrozenColumn>
                <input pInputText type="text" [(ngModel)]="filterValues.username" (input)="onFilterChange()"
                  placeholder="Search Username" class="w-full p-column-filter">
              </th>
              <th>
                <input pInputText type="text" [(ngModel)]="filterValues.firstName" (input)="onFilterChange()"
                  placeholder="Search First Name" class="w-full p-column-filter">
              </th>
              <th>
                <input pInputText type="text" [(ngModel)]="filterValues.lastName" (input)="onFilterChange()"
                  placeholder="Search Last Name" class="w-full p-column-filter">
              </th>
              <th>
                <input pInputText type="text" [(ngModel)]="filterValues.email" (input)="onFilterChange()"
                  placeholder="Search Email" class="w-full p-column-filter">
              </th>
              <th>
                <!-- No filter for Status -->
              </th>
              <th>
                <!-- No filter for Last Login -->
              </th>
              <th>
                <!-- No filter for Created -->
              </th>
              <th>
                <!-- No filter for Actions -->
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-admin>
            <tr class="modern-row">
              <td pFrozenColumn>
                <a class="dataset-name-link" [routerLink]="['/app/org-admin/view', selectedOrg, admin.id]">
                  {{ admin.username }}
                </a>
              </td>
              <td>
                <span class="description-text">{{ admin.firstName }}</span>
              </td>
              <td>
                <span class="description-text">{{ admin.lastName }}</span>
              </td>
              <td>
                <span class="description-text" [title]="admin.email">{{ admin.email }}</span>
              </td>
              <td>
                <span class="status-indicator"
                  [ngClass]="{'active': admin.status === 1, 'inactive': admin.status !== 1}">
                  <span class="dot"></span>
                  {{ admin.status === 1 ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td>
                <span class="date-text">
                  {{ admin.lastLogin ? (admin.lastLogin | date:'medium') : 'Never logged in' }}
                </span>
              </td>
              <td>
                <span class="date-text">{{ admin.createdOn | date:'medium' }}</span>
              </td>
              <td>
                <div class="row-actions">
                  <button class="icon-btn edit-btn" (click)="onEdit(admin.id)" pTooltip="Edit" tooltipPosition="left"
                    [disabled]="!showOrganisationDropdown && admin.id == loggedInUserId">
                    <i class="pi pi-pencil"></i>
                  </button>
                  <button class="icon-btn delete-btn" (click)="confirmDelete(admin.id)" pTooltip="Delete"
                    tooltipPosition="left" [disabled]="!showOrganisationDropdown && admin.id == loggedInUserId">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="6" class="empty-message-cell text-center">
                No such record found
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>

<div class="confirmation-popup" *ngIf="showDeleteConfirm">
  <div class="popup-content">
    <!-- Header -->
    <div class="popup-header">
      <div class="popup-icon">
        <i class="pi pi-trash"></i>
      </div>
      <h3>Confirm Delete</h3>
    </div>

    <!-- Delete Info Section -->
    <div class="standard-delete-section">
      <p class="delete-intro">
        Are you sure you want to delete this admin?
      </p>

      <ul class="delete-info-list">
        <li>
          <i class="pi pi-info-circle"></i>
          <span>Admin access will be revoked</span>
        </li>
        <li>
          <i class="pi pi-info-circle"></i>
          <span>Login credentials will be invalidated</span>
        </li>
        <li>
          <i class="pi pi-info-circle"></i>
          <span>This action cannot be undone</span>
        </li>
      </ul>
    </div>

    <!-- Actions -->
    <div class="popup-actions">
      <button class="btn-cancel" (click)="cancelDelete()">
        <i class="pi pi-times"></i>
        Cancel
      </button>
      <button class="btn-confirm" (click)="proceedDelete()">
        <i class="pi pi-trash"></i>
        Delete
      </button>
    </div>
  </div>
</div>