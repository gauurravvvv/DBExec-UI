<div class="query-editor-wrapper">
    <!-- Header Toolbar -->
    <div class="query-toolbar">
        <div class="toolbar-left">
            <h3 class="toolbar-title">
                Create Analysis
            </h3>
        </div>
        <div class="toolbar-right">
            <button pButton class="p-button-text btn-primary" title="Save Analysis" (click)="saveAnalysis()"
                [disabled]="!canSave">
                <i class="pi pi-save"></i>
            </button>
        </div>
    </div>

    <!-- Sub Header with Toggle Buttons -->
    <div class="sub-header">
        <button pButton class="p-button-text btn-primary field-btn" [class.active]="isFieldsPanelOpen"
            (click)="toggleFieldsPanel()" title="Toggle Fields Pane">
            <i class="pi pi-database"></i>
        </button>
        <button pButton class="p-button-text btn-primary visual-btn" [class.active]="isVisualsPanelOpen"
            (click)="toggleVisualsPanel()" title="Toggle Visuals Pane">
            <i class="pi pi-chart-bar"></i>
        </button>
    </div>

    <!-- Main Content Area with Sidebar and Center -->
    <div class="main-content">

        <!-- Left Sidebar - Fields Panel -->
        <div class="database-sidebar" [class.collapsed]="!isFieldsPanelOpen">
            <div class="sidebar-content">
                <div class="sidebar-header-info">
                    <div class="dataset-label">Dataset</div>
                </div>
                <div class="sidebar-divider"></div>
                <div class="sidebar-content-inner">
                    <!-- Dataset Name Section -->
                    <div class="dataset-name-section">
                        <div class="dataset-name-divider">
                            <span class="dataset-name-text">{{ datasetDetails?.name }}</span>
                        </div>
                    </div>

                    <!-- Fields List -->
                    <div class="fields-list">
                        <div class="field-card" *ngFor="let field of datasetDetails?.datasetFields"
                            [class.custom-field]="field.type === 2">
                            <div class="field-icon">
                                <i class="pi pi-bars"></i>
                            </div>
                            <div class="field-info">
                                <div class="field-name">{{ field.columnToView }}</div>
                            </div>
                            <div class="field-menu">
                                <i class="pi pi-ellipsis-v"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Left Sidebar 2 - Visuals Panel -->
        <div class="visuals-sidebar" [class.collapsed]="!isVisualsPanelOpen">
            <div class="sidebar-content">
                <div class="sidebar-header-info">
                    <div class="dataset-label">
                        {{ focusedVisualId && !getFocusedVisual()?.chartType ? 'Select Chart Type' :
                        focusedVisualId && getFocusedVisual()?.chartType ? 'Data Mapping' : 'Visuals' }}
                    </div>
                </div>
                <div class="sidebar-divider"></div>
                <div class="sidebar-content-inner">
                    <!-- Add Visual Button (always visible) -->
                    <div class="add-visual-section">
                        <button pButton label="Add Visual" icon="pi pi-plus" class="p-button-outlined add-visual-button"
                            (click)="addVisual()"></button>
                    </div>

                    <!-- Chart Type Grid (when visual is focused but no chart type selected) -->
                    <div class="chart-type-section" *ngIf="focusedVisualId && !getFocusedVisual()?.chartType">
                        <div class="chart-type-hint">
                            <i class="pi pi-info-circle"></i>
                            <span>Select a chart type for this visual</span>
                        </div>
                        <div class="chart-categories">
                            <div class="chart-category-section" *ngFor="let category of getChartCategories()">
                                <div class="category-label">{{ category }}</div>
                                <div class="chart-type-grid">
                                    <div class="chart-type-card" *ngFor="let chartType of getChartsByCategory(category)"
                                        [class.selected]="getFocusedVisual()?.chartType === chartType.id"
                                        (click)="setVisualChartType(chartType)" [pTooltip]="chartType.description"
                                        tooltipPosition="bottom">
                                        <div class="chart-icon" [class.rotate]="chartType.rotate">
                                            <i [class]="chartType.icon"></i>
                                        </div>
                                        <div class="chart-name">{{ chartType.name }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Mapping Section (when chart type is already selected) -->
                    <div class="chart-type-section" *ngIf="focusedVisualId && getFocusedVisual()?.chartType">
                        <!-- Axis Column Selection (show when chart type is selected) -->
                        <div class="axis-selection-section"
                            *ngIf="getFocusedVisual()?.chartType && hasAxisLabels(getFocusedVisual()?.chartType)">
                            <div class="section-divider"></div>
                            <div class="axis-selection-title">Data Mapping</div>
                            <div class="axis-group">
                                <label>X-Axis Column</label>
                                <p-dropdown [options]="datasetDetails?.datasetFields"
                                    [(ngModel)]="getFocusedVisual().xAxisColumn" optionLabel="columnToView"
                                    optionValue="columnName" placeholder="Select column" [style]="{'width': '100%'}">
                                </p-dropdown>
                            </div>
                            <div class="axis-group">
                                <label>Y-Axis Column</label>
                                <p-dropdown [options]="datasetDetails?.datasetFields"
                                    [(ngModel)]="getFocusedVisual().yAxisColumn" optionLabel="columnToView"
                                    optionValue="columnName" placeholder="Select column" [style]="{'width': '100%'}">
                                </p-dropdown>
                            </div>
                        </div>

                        <!-- Value/Category for non-axis charts (pie, gauge, cards) -->
                        <div class="axis-selection-section"
                            *ngIf="getFocusedVisual()?.chartType && !hasAxisLabels(getFocusedVisual()?.chartType)">
                            <div class="section-divider"></div>
                            <div class="axis-selection-title">Data Mapping</div>
                            <div class="axis-group">
                                <label>Category Column</label>
                                <p-dropdown [options]="datasetDetails?.datasetFields"
                                    [(ngModel)]="getFocusedVisual().xAxisColumn" optionLabel="columnToView"
                                    optionValue="columnName" placeholder="Select column" [style]="{'width': '100%'}">
                                </p-dropdown>
                            </div>
                            <div class="axis-group">
                                <label>Value Column</label>
                                <p-dropdown [options]="datasetDetails?.datasetFields"
                                    [(ngModel)]="getFocusedVisual().yAxisColumn" optionLabel="columnToView"
                                    optionValue="columnName" placeholder="Select column" [style]="{'width': '100%'}">
                                </p-dropdown>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Center Container -->
        <div class="editor-container">
            <div class="canvas-area" *ngIf="visuals.length > 0" (click)="clearFocus()">
                <div class="visual-box" *ngFor="let visual of visuals" [class.focused]="focusedVisualId === visual.id"
                    [class.disabled]="focusedVisualId !== null && focusedVisualId !== visual.id"
                    [class.dragging]="draggingVisual === visual" [style.width.px]="visual.width"
                    [style.height.px]="visual.height" draggable="true" (dragstart)="startDrag($event, visual)"
                    (dragover)="onDragOver($event, visual)" (drop)="onDrop($event, visual)"
                    (dragend)="onDragEnd($event)" (click)="onVisualClick($event, visual.id)"
                    (contextmenu)="onVisualRightClick($event, visual.id)">
                    <!-- Inline Title (shown above chart) -->
                    <div class="visual-inline-title">
                        <span *ngIf="editingTitleId !== visual.id" (click)="startEditTitle(visual.id, $event)"
                            class="inline-title-text">{{visual.title}}</span>
                        <div *ngIf="editingTitleId === visual.id" class="title-edit-container">
                            <input type="text" [(ngModel)]="visual.title" maxlength="100" (blur)="finishEditTitle()"
                                (keydown)="onTitleKeydown($event)" class="title-input">
                            <span class="char-counter">{{100 - (visual.title?.length || 0)}} chars left</span>
                        </div>
                        <!-- Chart type and action buttons -->
                        <div class="visual-action-buttons">
                            <button *ngIf="visual.chartType" pButton icon="pi pi-refresh"
                                class="p-button-text p-button-sm action-btn" (click)="clearChartType()"
                                pTooltip="Change chart type" tooltipPosition="top">
                            </button>
                            <button pButton icon="pi pi-times" class="p-button-text p-button-sm action-btn close-btn"
                                (click)="removeVisual(visual.id)" pTooltip="Remove" tooltipPosition="top">
                            </button>
                        </div>
                    </div>
                    <div class="visual-body">
                        <!-- Placeholder when no chart type selected -->
                        <div class="visual-content-placeholder" *ngIf="!visual.chartType">
                            <i class="pi pi-chart-bar"></i>
                            <p>Click to select chart type, right-click to configure</p>
                            <small>{{ visual.width }}px Ã— {{ visual.height }}px</small>
                        </div>

                        <!-- Bar Chart Types -->
                        <app-configurable-bar-chart *ngIf="isBarChartType(visual.chartType)" [showConfigPanel]="false"
                            [chartWidth]="visual.width" [chartHeight]="visual.height - 45" [chartConfig]="visual.config"
                            [chartType]="visual.chartType">
                        </app-configurable-bar-chart>

                        <!-- Line Chart -->
                        <app-configurable-line-chart *ngIf="visual.chartType === 'line'" [showConfigPanel]="false"
                            [chartWidth]="visual.width" [chartHeight]="visual.height - 45"
                            [chartConfig]="visual.config">
                        </app-configurable-line-chart>

                        <!-- Area Chart Types -->
                        <app-configurable-area-chart *ngIf="isAreaChartType(visual.chartType)" [showConfigPanel]="false"
                            [chartWidth]="visual.width" [chartHeight]="visual.height - 45" [chartConfig]="visual.config"
                            [chartType]="visual.chartType">
                        </app-configurable-area-chart>

                        <!-- Polar/Radar Chart -->
                        <app-configurable-polar-chart *ngIf="visual.chartType === 'polar'" [showConfigPanel]="false"
                            [chartWidth]="visual.width" [chartHeight]="visual.height - 45"
                            [chartConfig]="visual.config">
                        </app-configurable-polar-chart>

                        <!-- Pie Chart Types -->
                        <app-configurable-pie-chart *ngIf="isPieChartType(visual.chartType)" [showConfigPanel]="false"
                            [chartWidth]="visual.width" [chartHeight]="visual.height - 45" [chartConfig]="visual.config"
                            [chartType]="visual.chartType">
                        </app-configurable-pie-chart>

                        <!-- Gauge Chart Types -->
                        <app-configurable-gauge-chart *ngIf="isGaugeChartType(visual.chartType)"
                            [showConfigPanel]="false" [chartWidth]="visual.width" [chartHeight]="visual.height - 45"
                            [chartConfig]="visual.config" [chartType]="visual.chartType">
                        </app-configurable-gauge-chart>

                        <!-- Number Card Chart -->
                        <app-configurable-card-chart *ngIf="isCardChartType(visual.chartType)" [showConfigPanel]="false"
                            [chartWidth]="visual.width" [chartHeight]="visual.height - 45"
                            [chartConfig]="visual.config">
                        </app-configurable-card-chart>

                        <!-- Heat Map Chart -->
                        <app-configurable-heatmap-chart *ngIf="isHeatMapChartType(visual.chartType)"
                            [showConfigPanel]="false" [chartWidth]="visual.width" [chartHeight]="visual.height - 45"
                            [chartConfig]="visual.config">
                        </app-configurable-heatmap-chart>

                        <!-- Tree Map Chart -->
                        <app-configurable-treemap-chart *ngIf="isTreeMapChartType(visual.chartType)"
                            [showConfigPanel]="false" [chartWidth]="visual.width" [chartHeight]="visual.height - 45"
                            [chartConfig]="visual.config">
                        </app-configurable-treemap-chart>
                    </div>
                    <!-- Resize Handles -->
                    <div class="resize-handle-top" (mousedown)="startResize($event, visual, 'top')"></div>
                    <div class="resize-handle-right" (mousedown)="startResize($event, visual, 'right')"></div>
                    <div class="resize-handle-bottom" (mousedown)="startResize($event, visual, 'bottom')"></div>
                    <div class="resize-handle-left" (mousedown)="startResize($event, visual, 'left')"></div>
                    <div class="resize-handle-corner-br" (mousedown)="startResize($event, visual, 'bottom-right')">
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div class="empty-state" *ngIf="visuals.length === 0">
                <i class="pi pi-chart-bar"></i>
                <h3>No Visuals Yet</h3>
                <p>Click the "Add Visual" button to create your first visualization</p>
                <div class="empty-state-tips">
                    <div class="tip-item">
                        <i class="pi pi-info-circle"></i>
                        <span>Click to select chart type, right-click to configure</span>
                    </div>
                    <div class="tip-item">
                        <i class="pi pi-info-circle"></i>
                        <span>Drag edges to resize</span>
                    </div>
                    <div class="tip-item">
                        <i class="pi pi-info-circle"></i>
                        <span>Click title to rename</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Configuration Sidebar (opens on right-click only) -->
        <div class="config-sidebar" *ngIf="isConfigSidebarOpen && focusedVisualId && getFocusedVisual()?.chartType">
            <div class="sidebar-content">
                <div class="sidebar-header-info">
                    <div class="dataset-label">Chart Configuration</div>
                    <button pButton icon="pi pi-times" class="p-button-text p-button-sm close-btn"
                        (click)="closeConfigSidebar()" title="Close"></button>
                </div>
                <div class="sidebar-divider"></div>
                <div class="sidebar-content-inner config-form">
                    <!-- Color Scheme -->
                    <div class="config-group">
                        <label>Color Scheme</label>
                        <p-dropdown [options]="colorSchemes" [(ngModel)]="getFocusedVisual().config.colorScheme"
                            optionLabel="label" optionValue="value" [style]="{'width': '100%'}">
                        </p-dropdown>
                    </div>

                    <!-- Axis Options (Not for pie/gauge/card charts - they don't have X/Y axes) -->
                    <div class="config-section"
                        *ngIf="!isPieChartType(getFocusedVisual()?.chartType) && !isGaugeChartType(getFocusedVisual()?.chartType) && !isCardChartType(getFocusedVisual()?.chartType)">
                        <div class="section-title">Axis Options</div>
                        <div class="config-row">
                            <label>Show X Axis</label>
                            <p-inputSwitch [(ngModel)]="getFocusedVisual().config.xAxis"></p-inputSwitch>
                        </div>
                        <div class="config-row">
                            <label>Show Y Axis</label>
                            <p-inputSwitch [(ngModel)]="getFocusedVisual().config.yAxis"></p-inputSwitch>
                        </div>
                        <div class="config-row">
                            <label>Show Grid Lines</label>
                            <p-inputSwitch [(ngModel)]="getFocusedVisual().config.showGridLines"></p-inputSwitch>
                        </div>
                    </div>

                    <!-- Labels (Only for charts with traditional axes - not pie/polar) -->
                    <div class="config-section" *ngIf="hasAxisLabels(getFocusedVisual()?.chartType)">
                        <div class="section-title">Labels</div>
                        <div class="config-row">
                            <label>Show X Axis Label</label>
                            <p-inputSwitch [(ngModel)]="getFocusedVisual().config.showXAxisLabel"></p-inputSwitch>
                        </div>
                        <div class="config-group" *ngIf="getFocusedVisual().config.showXAxisLabel">
                            <label>X Axis Label</label>
                            <input type="text" pInputText [(ngModel)]="getFocusedVisual().config.xAxisLabel" />
                        </div>
                        <div class="config-row">
                            <label>Show Y Axis Label</label>
                            <p-inputSwitch [(ngModel)]="getFocusedVisual().config.showYAxisLabel"></p-inputSwitch>
                        </div>
                        <div class="config-group" *ngIf="getFocusedVisual().config.showYAxisLabel">
                            <label>Y Axis Label</label>
                            <input type="text" pInputText [(ngModel)]="getFocusedVisual().config.yAxisLabel" />
                        </div>
                        <!-- Show Data Labels only for bar charts -->
                        <div class="config-row" *ngIf="isBarChartType(getFocusedVisual()?.chartType)">
                            <label>Show Data Labels</label>
                            <p-inputSwitch [(ngModel)]="getFocusedVisual().config.showDataLabel"></p-inputSwitch>
                        </div>
                    </div>

                    <!-- Display Options -->
                    <div class="config-section">
                        <div class="section-title">Display Options</div>

                        <!-- Legend Options (not for card charts) -->
                        <ng-container *ngIf="!isCardChartType(getFocusedVisual()?.chartType)">
                            <div class="config-row">
                                <label>Show Legend</label>
                                <p-inputSwitch [(ngModel)]="getFocusedVisual().config.legend"></p-inputSwitch>
                            </div>
                            <ng-container *ngIf="getFocusedVisual().config.legend">
                                <div class="config-group">
                                    <label>Legend Position</label>
                                    <p-dropdown [options]="legendPositions"
                                        [(ngModel)]="getFocusedVisual().config.legendPosition" optionLabel="label"
                                        optionValue="value" [style]="{'width': '100%'}">
                                    </p-dropdown>
                                </div>
                                <div class="config-group">
                                    <label>Legend Title</label>
                                    <input type="text" pInputText [(ngModel)]="getFocusedVisual().config.legendTitle" />
                                </div>
                            </ng-container>
                        </ng-container>

                        <!-- Styling Options -->
                        <div class="config-row" *ngIf="supportsGradient(getFocusedVisual()?.chartType)">
                            <label>Gradient Fill</label>
                            <p-inputSwitch [(ngModel)]="getFocusedVisual().config.gradient"></p-inputSwitch>
                        </div>
                        <div class="config-row">
                            <label>Animations</label>
                            <p-inputSwitch [(ngModel)]="getFocusedVisual().config.animations"></p-inputSwitch>
                        </div>
                        <div class="config-row">
                            <label>Disable Tooltip</label>
                            <p-inputSwitch [(ngModel)]="getFocusedVisual().config.tooltipDisabled"></p-inputSwitch>
                        </div>
                        <div class="config-row" *ngIf="hasAxisLabels(getFocusedVisual()?.chartType)">
                            <label>Round Domains</label>
                            <p-inputSwitch [(ngModel)]="getFocusedVisual().config.roundDomains"></p-inputSwitch>
                        </div>

                        <!-- Bar Chart Specific Options -->
                        <ng-container *ngIf="isBarChartType(getFocusedVisual()?.chartType)">
                            <div class="section-title" style="margin-top: 12px;">Bar Chart Options</div>
                            <div class="config-group">
                                <label>Bar Padding</label>
                                <p-inputNumber [(ngModel)]="getFocusedVisual().config.barPadding" [min]="0" [max]="50"
                                    [showButtons]="true" [style]="{'width': '100%'}">
                                </p-inputNumber>
                            </div>
                            <div class="config-row">
                                <label>Round Edges</label>
                                <p-inputSwitch [(ngModel)]="getFocusedVisual().config.roundEdges"></p-inputSwitch>
                            </div>
                            <div class="config-row">
                                <label>Hide Zero Bars</label>
                                <p-inputSwitch [(ngModel)]="getFocusedVisual().config.noBarWhenZero"></p-inputSwitch>
                            </div>
                        </ng-container>

                        <!-- Line Chart Specific Options -->
                        <ng-container *ngIf="getFocusedVisual()?.chartType === 'line'">
                            <div class="config-group">
                                <label>Curve Type</label>
                                <p-dropdown [options]="curveTypes" [(ngModel)]="getFocusedVisual().config.curveType"
                                    optionLabel="label" optionValue="value" [style]="{'width': '100%'}">
                                </p-dropdown>
                            </div>
                            <div class="config-row">
                                <label>Auto Scale</label>
                                <p-inputSwitch [(ngModel)]="getFocusedVisual().config.autoScale"></p-inputSwitch>
                            </div>
                            <div class="config-row">
                                <label>Timeline</label>
                                <p-inputSwitch [(ngModel)]="getFocusedVisual().config.timeline"></p-inputSwitch>
                            </div>
                        </ng-container>

                        <!-- Area Chart Specific Options -->
                        <ng-container *ngIf="isAreaChartType(getFocusedVisual()?.chartType)">
                            <div class="config-group">
                                <label>Curve Type</label>
                                <p-dropdown [options]="curveTypes" [(ngModel)]="getFocusedVisual().config.curveType"
                                    optionLabel="label" optionValue="value" [style]="{'width': '100%'}">
                                </p-dropdown>
                            </div>
                            <div class="config-row">
                                <label>Auto Scale</label>
                                <p-inputSwitch [(ngModel)]="getFocusedVisual().config.autoScale"></p-inputSwitch>
                            </div>
                            <div class="config-row">
                                <label>Timeline</label>
                                <p-inputSwitch [(ngModel)]="getFocusedVisual().config.timeline"></p-inputSwitch>
                            </div>
                        </ng-container>

                        <!-- Pie Chart Specific Options -->
                        <ng-container *ngIf="isPieChartType(getFocusedVisual()?.chartType)">
                            <div class="section-title" style="margin-top: 12px;">Pie Chart Options</div>
                            <div class="config-row">
                                <label>Show Labels</label>
                                <p-inputSwitch [(ngModel)]="getFocusedVisual().config.labels"></p-inputSwitch>
                            </div>
                            <ng-container *ngIf="getFocusedVisual().config.labels">
                                <div class="config-row">
                                    <label>Trim Labels</label>
                                    <p-inputSwitch [(ngModel)]="getFocusedVisual().config.trimLabels"></p-inputSwitch>
                                </div>
                                <div class="config-group" *ngIf="getFocusedVisual().config.trimLabels">
                                    <label>Max Label Length</label>
                                    <p-inputNumber [(ngModel)]="getFocusedVisual().config.maxLabelLength" [min]="5"
                                        [max]="50" [showButtons]="true" [style]="{'width': '100%'}">
                                    </p-inputNumber>
                                </div>
                            </ng-container>
                            <div class="config-row" *ngIf="getFocusedVisual()?.chartType === 'pie'">
                                <label>Doughnut</label>
                                <p-inputSwitch [(ngModel)]="getFocusedVisual().config.doughnut"></p-inputSwitch>
                            </div>
                            <div class="config-group"
                                *ngIf="getFocusedVisual().config.doughnut && getFocusedVisual()?.chartType === 'pie'">
                                <label>Arc Width</label>
                                <p-inputNumber [(ngModel)]="getFocusedVisual().config.arcWidth" [min]="0.1" [max]="0.9"
                                    [step]="0.05" [showButtons]="true" [style]="{'width': '100%'}">
                                </p-inputNumber>
                            </div>
                            <div class="config-row" *ngIf="getFocusedVisual()?.chartType === 'pie'">
                                <label>Explode Slices</label>
                                <p-inputSwitch [(ngModel)]="getFocusedVisual().config.explodeSlices"></p-inputSwitch>
                            </div>
                        </ng-container>

                        <!-- Polar Chart Specific Options -->
                        <ng-container *ngIf="getFocusedVisual()?.chartType === 'polar'">
                            <div class="section-title" style="margin-top: 12px;">Polar Chart Options</div>
                            <div class="config-row">
                                <label>Trim Labels</label>
                                <p-inputSwitch [(ngModel)]="getFocusedVisual().config.labelTrim"></p-inputSwitch>
                            </div>
                            <div class="config-group" *ngIf="getFocusedVisual().config.labelTrim">
                                <label>Max Label Length</label>
                                <p-inputNumber [(ngModel)]="getFocusedVisual().config.labelTrimSize" [min]="5"
                                    [max]="50" [showButtons]="true" [style]="{'width': '100%'}">
                                </p-inputNumber>
                            </div>
                            <div class="config-row">
                                <label>Show Series on Hover</label>
                                <p-inputSwitch
                                    [(ngModel)]="getFocusedVisual().config.showSeriesOnHover"></p-inputSwitch>
                            </div>
                            <div class="config-group">
                                <label>Range Fill Opacity</label>
                                <p-inputNumber [(ngModel)]="getFocusedVisual().config.rangeFillOpacity" [min]="0"
                                    [max]="1" [step]="0.05" [showButtons]="true" [style]="{'width': '100%'}">
                                </p-inputNumber>
                            </div>
                        </ng-container>

                        <!-- Gauge Chart Specific Options -->
                        <ng-container *ngIf="isGaugeChartType(getFocusedVisual()?.chartType)">
                            <div class="section-title" style="margin-top: 12px;">Gauge Chart Options</div>
                            <div class="config-group">
                                <label>Min Value</label>
                                <p-inputNumber [(ngModel)]="getFocusedVisual().config.min" [showButtons]="true"
                                    [style]="{'width': '100%'}">
                                </p-inputNumber>
                            </div>
                            <div class="config-group">
                                <label>Max Value</label>
                                <p-inputNumber [(ngModel)]="getFocusedVisual().config.max" [showButtons]="true"
                                    [style]="{'width': '100%'}">
                                </p-inputNumber>
                            </div>
                            <div class="config-group">
                                <label>Units</label>
                                <input type="text" pInputText [(ngModel)]="getFocusedVisual().config.units" />
                            </div>
                            <ng-container *ngIf="getFocusedVisual()?.chartType === 'gauge'">
                                <div class="config-row">
                                    <label>Show Axis</label>
                                    <p-inputSwitch [(ngModel)]="getFocusedVisual().config.showAxis"></p-inputSwitch>
                                </div>
                                <div class="config-row">
                                    <label>Show Text</label>
                                    <p-inputSwitch [(ngModel)]="getFocusedVisual().config.showText"></p-inputSwitch>
                                </div>
                                <div class="config-group" *ngIf="getFocusedVisual().config.showAxis">
                                    <label>Big Segments</label>
                                    <p-inputNumber [(ngModel)]="getFocusedVisual().config.bigSegments" [min]="1"
                                        [max]="20" [showButtons]="true" [style]="{'width': '100%'}">
                                    </p-inputNumber>
                                </div>
                                <div class="config-group" *ngIf="getFocusedVisual().config.showAxis">
                                    <label>Small Segments</label>
                                    <p-inputNumber [(ngModel)]="getFocusedVisual().config.smallSegments" [min]="0"
                                        [max]="10" [showButtons]="true" [style]="{'width': '100%'}">
                                    </p-inputNumber>
                                </div>
                                <div class="config-group">
                                    <label>Angle Span (degrees)</label>
                                    <p-inputNumber [(ngModel)]="getFocusedVisual().config.angleSpan" [min]="90"
                                        [max]="360" [showButtons]="true" [style]="{'width': '100%'}">
                                    </p-inputNumber>
                                </div>
                                <div class="config-group">
                                    <label>Start Angle (degrees)</label>
                                    <p-inputNumber [(ngModel)]="getFocusedVisual().config.startAngle" [min]="-180"
                                        [max]="180" [showButtons]="true" [style]="{'width': '100%'}">
                                    </p-inputNumber>
                                </div>
                            </ng-container>
                        </ng-container>

                        <!-- Number Card Chart Specific Options -->
                        <ng-container *ngIf="isCardChartType(getFocusedVisual()?.chartType)">
                            <div class="section-title" style="margin-top: 12px;">Card Options</div>
                            <div class="config-group">
                                <label>Inner Padding</label>
                                <p-inputNumber [(ngModel)]="getFocusedVisual().config.innerPadding" [min]="0" [max]="50"
                                    [showButtons]="true" [style]="{'width': '100%'}">
                                </p-inputNumber>
                            </div>
                        </ng-container>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Save Analysis Dialog -->
<app-save-analyses-dialog [visible]="showSaveDialog" (close)="handleSaveDialogClose($event)">
</app-save-analyses-dialog>